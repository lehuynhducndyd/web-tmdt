<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>
        <%= product.name %> - Chi tiết sản phẩm
    </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <link href="/client/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="/client/lib/lightbox/css/lightbox.min.css" rel="stylesheet">

    <link href="/client/css/bootstrap.min.css" rel="stylesheet">

    <link href="/client/css/style.css" rel="stylesheet">

<style>
    #shop-detail-page {
        background-color: #f8f9fa;
    }

    /* KHẮC PHỤC BỐ CỤC CỘT QUAN TRỌNG START */
    /* Đảm bảo hàng chính là Flexbox container */
    #shop-detail-page .row.g-4.mb-5 {
        display: flex;
        flex-wrap: wrap;
        /* Cho phép các cột xuống dòng nếu cần */
        align-items: flex-start;
        /* Căn chỉnh các cột lên trên cùng */
        margin: 0 -15px;
        /* Sửa lỗi margin âm của row */
    }

    /* Cột ảnh (col-xl-4) */
    #shop-detail-page .col-xl-4 {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
        padding: 15px;
    }

    /* Cột thông tin sản phẩm (col-xl-5) */
    #shop-detail-page .col-xl-5 {
        flex: 0 0 41.666667%;
        max-width: 41.666667%;
        padding: 15px 20px;
    }

    /* Cột thông số kỹ thuật (col-xl-3) */
    #shop-detail-page .col-xl-3 {
        flex: 0 0 25%;
        max-width: 25%;
        padding: 25px;
        background: #ffffff;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        font-size: 0.9rem;
    }

    /* KHẮC PHỤC BỐ CỤC CỘT QUAN TRỌNG END */

    /* Cải thiện hiển thị văn bản tràn */
    #shop-detail-page h1,
    #shop-detail-page h5 {
        white-space: normal;
        /* Cho phép tiêu đề xuống dòng */
        word-break: break-word;
    }

    /* Cải thiện các thành phần nhỏ */

    #shop-detail-page h1 {
        font-size: 2.5rem;
        /* Giảm nhẹ kích thước */
        font-weight: 800 !important;
        color: #333;
        margin-top: 0;
    }

    #shop-detail-page #variant-price-display {
        font-size: 1.8rem;
        color: #d63384 !important;
        margin-bottom: 20px !important;
        padding-bottom: 5px;
        border-bottom: 2px solid #eee;
    }

    #shop-detail-page .variant-selection {
        font-size: 0.9rem;
        padding: 10px 18px;
        transition: all 0.3s ease;
        font-weight: 600;
        border-color: #ced4da !important;
    }

    #shop-detail-page .variant-selection:hover,
    #shop-detail-page .btn-primary,
    #shop-detail-page .variant-selection.btn-primary {
        background-color: #007bff !important;
        border-color: #007bff !important;
        color: white !important;
    }

    #shop-detail-page .d-flex.mb-4 small {
        /* Sửa lỗi tràn dòng thương hiệu/danh mục */
        line-height: 1.4;
    }

    #shop-detail-page .list-unstyled li {
        padding: 5px 0;
        border-bottom: 1px dashed #eee;
    }

    #shop-detail-page .list-unstyled li i {
        color: #007bff !important;
    }

    #shop-detail-page .rounded {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #shop-detail-page .container-fluid.py-5.mt-5 {
        margin-top: 5rem !important;
        padding-top: 4rem !important;
    }
</style>
</head>

<body id="shop-detail-page">
    <%- include('../layout/navbar'); -%>

        <div class="container-fluid py-5 mt-5">
            <div class="container py-5">
                <div class="row g-4 mb-5">
                    <div class="col-lg-8 col-xl-4">
                        <div class="position-relative overflow-hidden rounded">
                            <% if (product.thumbnail && product.thumbnail.data) { %>
                                <img src="data:<%= product.thumbnail.contentType %>;base64,<%= product.thumbnail.data.toString('base64') %>"
                                    class="img-fluid w-100 rounded" alt="<%= product.name %>"
                                    style="height: 450px; object-fit: contain;">
                                <% } else { %>
                                    <img src="/admin/img/default-image.png" class="img-fluid w-100 rounded"
                                        alt="No Image" style="height: 450px; object-fit: contain;">
                                    <% } %>
                        </div>
                    </div>

                    <div class="col-lg-8 col-xl-5">
                        <h1 class="fw-bold mb-3">
                            <%= product.name %>
                        </h1>
                        <div class="d-flex mb-4">
                            <small class="me-3"><i class="fas fa-box text-warning me-2"></i>Thương hiệu: <strong>
                                    <%= product.brand ? product.brand.name : 'N/A' %>
                                </strong></small>
                            <small><i class="fas fa-list-alt text-warning me-2"></i>Danh mục: <strong>
                                    <%= product.category ? product.category.name : 'N/A' %>
                                </strong></small>
                        </div>

                        <% if (product.price> 0) { %>
                            <h4 class="fw-bold text-primary mb-4" id="variant-price-display">
                                Giá từ: <%= new Intl.NumberFormat('vi-VN', { style: 'currency' , currency: 'VND'
                                    }).format(product.price) %>
                            </h4>
                            <% } else { %>
                                <h4 class="fw-bold text-primary mb-4" id="variant-price-display">Giá: Liên hệ</h4>
                                <% } %>

                                <p class="mb-4">
                                    <strong>Mô tả ngắn:</strong>
                                    <%= product.description %>
                                </p>

                                    <h5 class="fw-bold mt-4">Chọn Phiên bản:</h5>
                                    <div class="d-flex flex-wrap mb-4">
                                        <% product.variants.forEach(function(variant){ %>
                                            <a href="#"
                                                class="btn btn-outline-secondary rounded-pill me-2 mb-2 variant-selection"
                                                data-color="<%= variant.color %>" data-ram="<%= variant.RAM %>"
                                                data-storage="<%= variant.storage %>" data-price="<%= variant.price %>">
                                                <%= variant.color %> | <%= variant.RAM %>/<%= variant.storage %> | <%=
                                                                new Intl.NumberFormat('vi-VN').format(variant.price) %>
                                                                đ
                                            </a>
                                            <% }); %>
                                    </div>
                                    <div class="d-flex align-items-center mb-5">
                                        <div class="input-group quantity me-3" style="width: 100px;">
                                            <div class="input-group-btn">
                                                <button class="btn btn-sm btn-minus rounded-circle bg-light border">
                                                    <i class="fa fa-minus"></i>
                                                </button>
                                            </div>
                                            <input type="text" class="form-control form-control-sm text-center border-0"
                                                value="1" id="quantityInput">
                                            <div class="input-group-btn">
                                                <button class="btn btn-sm btn-plus rounded-circle bg-light border">
                                                    <i class="fa fa-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <a href="#"
                                            class="btn border border-secondary rounded-pill px-4 py-2 text-primary">
                                            <i class="fa fa-shopping-bag me-2 text-primary"></i> Thêm vào giỏ
                                        </a>
                                    </div>
                    </div>

                    <div class="col-lg-12 col-xl-3">
                        <h5 class="fw-bold mb-4">Chi tiết sản phẩm</h5>
                        <p>
                            <%= product.detail %>
                        </p>

                        <h5 class="fw-bold mt-4">Thông số kỹ thuật chính:</h5>
                        <ul class="list-unstyled">
                            <% if (product.variants && product.variants.length> 0) { %>
                                <li><i class="fas fa-check text-success me-2"></i>RAM: **<%= product.variants[0].RAM %>
                                        **
                                        trở lên</li>
                                <li><i class="fas fa-check text-success me-2"></i>Bộ nhớ: **<%=
                                        product.variants[0].storage %>** trở lên</li>
                                <% } %>
                                    <li><i class="fas fa-check text-success me-2"></i>Thương hiệu: **<%= product.brand ?
                                            product.brand.name : 'N/A' %>**
                                    </li>
                        </ul>
                    </div>
                </div>

                <div class="container-fluid fruite py-5">
                    <div class="container py-5">
                        <h1 class="fw-bold mb-4">Sản phẩm liên quan</h1>
                        <div class="row g-4">
                            <% relatedProducts.forEach(function(relatedProduct){ %>
                                <div class="col-md-6 col-lg-4 col-xl-3">
                                    <div class="rounded position-relative fruite-item">
                                        <div class="fruite-img p-3">
                                            <% if (relatedProduct.thumbnail && relatedProduct.thumbnail.data) { %>
                                                <img src="data:<%= relatedProduct.thumbnail.contentType %>;base64,<%= relatedProduct.thumbnail.data.toString('base64') %>"
                                                    class="img-fluid w-100 rounded-top" alt="<%= relatedProduct.name %>"
                                                    style="height: 200px; object-fit: cover;">
                                                <% } else { %>
                                                    <img src="/admin/img/default-image.png"
                                                        class="img-fluid w-100 rounded-top" alt="No Image"
                                                        style="height: 200px; object-fit: cover;">
                                                    <% } %>
                                        </div>
                                        <div class="p-4 border border-secondary border-top-0 rounded-bottom">
                                            <h5><a href="/shop_detail/<%= relatedProduct._id %>">
                                                    <%= relatedProduct.name %>
                                                </a></h5>
                                            <div class="d-flex flex-lg-wrap justify-content-center">
                                                <p class="text-dark fs-5 fw-bold mb-3"
                                                    style="font-size: 15px; width: 100%; text-align: center;">
                                                    <% if (relatedProduct.price> 0) { %>
                                                        <%= new Intl.NumberFormat('vi-VN', { style: 'currency' ,
                                                            currency: 'VND' }).format(relatedProduct.price) %>
                                                            <% } else { %>
                                                                Liên hệ
                                                                <% } %>
                                                </p>
                                                <a href="/shop_detail/<%= relatedProduct._id %>"
                                                    class="btn border border-secondary rounded-pill px-3 text-primary mx-auto"><i
                                                        class="fa fa-shopping-bag me-2 text-primary"></i>
                                                    Xem chi tiết
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <%- include('../layout/footer'); -%>


            <a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top"><i
                    class="fa fa-arrow-up"></i></a>


            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
            <script src="/client/lib/easing/easing.min.js"></script>
            <script src="/client/lib/waypoints/waypoints.min.js"></script>
            <script src="/client/lib/lightbox/js/lightbox.min.js"></script>
            <script src="/client/lib/owlcarousel/owl.carousel.min.js"></script>

            <script src="/client/js/main.js"></script>

            <script>
                // Logic JS đơn giản để làm nổi bật biến thể đã chọn
                document.addEventListener('DOMContentLoaded', function () {
                    const variantButtons = document.querySelectorAll('.variant-selection');
                    const priceDisplay = document.getElementById('variant-price-display');

                    // Hàm định dạng tiền tệ
                    const formatCurrency = (price) => {
                        if (price <= 0 || isNaN(price)) {
                            return 'Giá: Liên hệ';
                        }
                        return 'Giá từ: ' + new Intl.NumberFormat('vi-VN', {
                            style: 'currency',
                            currency: 'VND'
                        }).format(price);
                    };

                    // Mặc định chọn biến thể đầu tiên (nếu có)
                    if (variantButtons.length > 0) {
                        let isInitiallySelected = Array.from(variantButtons).some(btn => btn.classList.contains('btn-primary'));

                        if (!isInitiallySelected) {
                            variantButtons[0].classList.remove('btn-outline-secondary');
                            variantButtons[0].classList.add('btn-primary');

                            const initialPrice = parseFloat(variantButtons[0].getAttribute('data-price'));
                            if (priceDisplay) {
                                priceDisplay.textContent = formatCurrency(initialPrice);
                            }
                        }
                    }


                    variantButtons.forEach(button => {
                        button.addEventListener('click', function (e) {
                            e.preventDefault();

                            variantButtons.forEach(btn => {
                                btn.classList.remove('btn-primary');
                                btn.classList.add('btn-outline-secondary');
                            });

                            this.classList.remove('btn-outline-secondary');
                            this.classList.add('btn-primary');

                            const selectedPrice = parseFloat(this.getAttribute('data-price'));
                            if (priceDisplay) {
                                priceDisplay.textContent = formatCurrency(selectedPrice);
                            }
                        });
                    });

                    // Logic tăng/giảm số lượng (từ template gốc)
                    const btnPlus = document.querySelector('.btn-plus');
                    const btnMinus = document.querySelector('.btn-minus');
                    const quantityInput = document.getElementById('quantityInput');

                    if (btnPlus && quantityInput) {
                        btnPlus.addEventListener('click', function () {
                            let value = parseInt(quantityInput.value);
                            quantityInput.value = value + 1;
                        });
                    }

                    if (btnMinus && quantityInput) {
                        btnMinus.addEventListener('click', function () {
                            let value = parseInt(quantityInput.value);
                            if (value > 1) {
                                quantityInput.value = value - 1;
                            }
                        });
                    }
                });
            </script>
</body>

</html>